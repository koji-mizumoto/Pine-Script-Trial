# TradingViewの作業メモ

## TradingView（無料版）

- 同時に開けるチャートタブ（タブの数）は2つまで
  - 3つ目を開いた後に最初に開いたタブを開くと、そのタブのチャートが強制的に接続が切られる（無料版の制限）
  - 不意に制限に引っ掛かる可能性もあるので、作ったスクリプトは随時コピペでローカルに保存しておくこと
  - 無料版はタブ1つに対して、1つのインジゲーター（1つのPineScript）しか表示できない
    - 追加のインジゲーターを作りたい場合は、新規でタブを作る
    - 無料版はタブを2つまでしか作れない点に注意する
  - 日足・週足・月足を別々のタブで開く場合は3つのタブを開くことになるので、無料版だと普通はできない。
    - ただし、PineScriptで1つのタブにまとめて描画するコードを書くと強引ではあるが制限を突破できる

## PineScript

- 最新版は、Version5
  - 更新は2021/10/7頃
  - これ以前の情報はVersion4以前のもので、スクリプトの文法が全然違うので注意
    - コードに@version4、study(...)関数があったら間違いなくv4以前のものなので、参考にするかはよく考えること。
    - ※studyは、v5でindicator関数に変わっている
    - 他にもema(v4)がta.ema(v5)になっているなど、多数の変更点が見られる
    - PineScriptエディタでは、旧式のコードはエラーが出る様になっている
  - エディタでv4からv5にコンバートすることができる模様

## PineScriptのコード

スクリプトは、JavaScriptがベースになっているようで、そちらの応用が利く。  
ただし、一部は独特な仕様とルールがあるので注意が必要

### var

JavaScriptでは、グローバル変数を定義する（ただし現在はこれを使うこと自体が非推奨）  
**PineScriptでは、変更できない変数の値を設定する**  
JavaScriptでいう、constに相当する。

### 変数名 := 値

PineScriptでは、既に設定した変数に値を再代入したいときに使う。  
他言語では、ほぼ「変数名 = 値」のコードで再代入できたが、PineScriptは違う。

- 例：変数long_maに最初30を割り当てて、そのあと20を割り当てたいとき。

~~~ 例
long_ma = 30
long_ma = 20    // × PineScriptでは間違い
long_ma := 20   // 〇 こちらが正しい
~~~

### PineScriptエディタ(TradingView付属)

TradingView付属のPineScriptエディタは、VSCodeと似た感覚で使うことができる。  
カラー別表示、ヒントの表示、矩形選択は大体似ている。

#### インデント

複数行に渡ってコードを書く場合、インデントのルールが少々特殊なので注意する  
ルールに従っていない場合はコンパイルをした時点でエラーがでる

- エラーは、end of line without continuation　になる
- 関数、for、if等で、範囲を指定する場合のインデントは【タブ1つor4つのスペース】
  - これは他の言語でも見られる記法
- 複数の行にわたる場合のインデントは【タブ1つor4つのスペース　+　**1つのスペース**】
  - この、1つのスペースが忘れやすい

#### PineScriptの描画について

後に描画したグラフが手前に表示される仕様

## 用語集

### ロング

- 株を「買う」こと

### ショート

- 株を「売る」こと

### エントリー (entry)

- **株関連の用語ではない**
- M&A、FXに関する用語
  - TradingView / PineScriptで出てくる単語なので補足
- 株を買うという意味も

### イグジット　／　エグジット (exit)

- **株関連の用語ではない**
- M&A、FXに関する用語
  - TradingView / PineScriptで出てくる単語なので補足
  - ベンチャービジネスや企業再生においてファンドや創業者が株式を売却し、利益を得る行為を指します。  
  または、ベンチャーキャピタル等の投資ファンドによる投資回収を指す言葉としても用いられます。
  - → 投資を回収する、利益確定、損切
- 株を売るという意味も

### ファンダメンタル分析

- 経済状況や企業の財務状況・経営状況などのデータを基に将来の株価を予測する分析手法。
  - 株価の予想ではなく、企業の業績予想や、資産の活用状況の把握に主眼が置かれる。
- 企業の価値と株価とを比較検討することで株式相場を分析する手法

### チャート分析

- 過去の株価データを基に将来の株価を予測する分析手法。
  - 株価が上昇基調なのか、下落基調なのかを予測する「トレンド系」の分析と、株価が買われ過ぎなのか、売られ過ぎなのかを分析する「オシレーター系」の分析に大きく分類される。

### トレンド分析（手法）

株価が上向き（上昇）か下向き（下降）か、または横ばい（保ち合い）で推移しているか、  
といった**株価の大局的な動き**のこと

### オシレーター分析（手法）

株価が買われすぎなのか売られすぎなのかを分析する
値が一定の間を振り子のように動く。下記は一例

- RSI
  - 値は0～100の範囲で動く。80以上が買われすぎ、20以下が売られすぎとすることが多い
- RCI
  - 値100～-100の範囲で動く。80以上が買われすぎ、-80以下が売られすぎとすることが多い

### シグナル

株式市場において投資家が意思決定を行うための「合図」や「指標」を表す指標。  
具体的には、株価の動きや経済指標、企業の業績などから得られる情報を基に、株を買うべきか売るべきかの判断材料を示す。  
このシグナルは、投資家が市場の動向を把握し、適切なタイミングで取引を行うために非常に重要である。

- [シグナル](https://sales.fromation.co.jp/archives/10000072079)

### ストラテジー

経済環境や相場環境などのファンダメンタル分析やテクニカル分析などから導いた投資戦略や投資方針のこと

- [ストラテジー](https://kabu.com/glossary/kabu2357.html)

### アラート

- ※ **株関連の用語ではない。**
- ソフトウェアや株価のサイトで、特定の条件を満たした時に利用者のデバイス（スマホ等）に通知をするシステムのこと
  - 計算式の結果がシグナルの条件を満たす → アラートを出す
  - 要は、利用者がこれらに張り付く必要を減らすための方法である。
  - TradingViewでは、alert関数を使う、alertcondion関数でアラート条件を作ることができる

### ダマシ

どんなテクニカル分析にもありうる事象  
「上がるはずのパターンで上がらない」「下がるはずのパターンで下がらない」というもの  
これを回避するには、以下の対策をとる

- いま使っている分析・指標をさらに詳しく分析する
- 他のテクニカル指標と組み合わせる
- ファンダメンタルズ分析と組み合わせる

ただ、対策をとっても「**どんなチャート分析も百発百中はない**」という事は理解しておくこと

## 分析方法

### 指数平滑移動平均線、Exponential Moving Average(EMA)

- テクニカル指標、トレンド分析
  - 直近の終値に強く比重を掛けて平均値を計算しているため、より直近の値動きに敏感に反応するテクニカルチャート

### 単純移動平均線、Simple Moving Average(SMA)

- テクニカル指標、トレンド分析
  - 指定下期間の値を等しく反映する

### ボリンジャーバンド

- テクニカル指標、トレンド分析
  - 移動平均線と標準偏差で構成されており、移動平均を表す線とその上下に値動きの幅を示す線を加えた指標で、「価格の大半がこの帯（バンド）の中に収まる」という統計学を応用したテクニカル指標のひとつ。
    - 標準偏差の計算式　標準偏差＝√(n×n日間の終値の2乗の合計－n日間の終値の合計の2乗)÷(n×(n－1))
  - ボリンジャーバンドの計算式　±1σ ＝ n日の移動平均 ± n日の標準偏差
±2σ ＝ n日の移動平均 ± n日の標準偏差 × 2
±3σ ＝ n日の移動平均 ± n日の標準偏差 × 3
  - 特徴は、収束と拡散を繰り返していることで、この動きにあわせて「順張り」「逆張り」それぞれの投資に利用することができる
  - [ボリンジャーバンド](https://info.monex.co.jp/technical-analysis/indicators/003.html)

### 相対力指数（RSI）

- テクニカル指標、オシレーター分析
  - 現在の相場の相対的な強弱（又は過熱感）を表す指標
  - 特徴としてボックス相場が続いているときの的中率は高いものの、上下に強いトレンドが出ると、売買シグナルが出ていたとしても、トレンドの勢いが止まらずに、結局ダマシに終わることがある
    - 計算式１　RS＝（n日間の終値の上昇幅の平均）÷（n日間の終値の下落幅の平均）
    - 計算式２　RSI= 100　-　（100　÷　（RS+1））
  - [RSI](https://info.monex.co.jp/technical-analysis/indicators/005.html)

### 順位相関指数（RCI）

- テクニカル指標、オシレーター分析
  - 過熱感を測り、現在の価格が割安か割高かを判断するときに使われる
  - 株価の動きに対して、上下に大きく動きやすいという特徴もあり、オシレーターの中でも反応が早い
  - 使用日数は下記

| |||||
|------------|---|---|---|---|
|日足|9日|13日|26日|52日|
|週足|9週|13週|26週| |
|月足|9ヶ月| 13ヶ月| | |

### 移動平均収束拡散・移動平均収束乖離（MACD）

- ※通称マックディー
- テクニカル指標、トレンド分析
  - 計算式
    - MACD＝短期EMA－長期EMA
    - MACDシグナル＝MACDのEMA

### ストキャスティクス

期間を任意に設定し、その間の終値が高値上限にあるのか安値上限にあるのかを視覚化する。  
ファストストキャスティクスとスローストキャスティクスがある。  
PineScriptで計算されるものは、ファストストキャスティクスの%Kである。

- **%Kライン**：現在の価格位置の相対的水準
  - 計算式：（当日終値－過去n日間の最安値）÷（過去n日間の最高値－過去n日間の最安値）×100
  - PineScriptでは
- **%Dライン**：「%Kライン」のn日間の移動平均線
  - 計算式：（当日終値－過去n日間の最安値）のm日間の合計÷（過去n日間の最高値－過去n日間の最安値）のm日間の合計×100
  - PineScriptでは、[1] ストキャスティクス：ファストストキャスティクスの%Dかつ、スローストキャスティクス %K　を求める
  - [2]スローストキャスティクス%Dを求める
- [参考サイト](https://www.oanda.jp/lab-education/beginners/technical_analysis/stoch/)

%Kラインの計算式

~~~ pine
ta.stoch(close, high, low, 過去n日間（*整数）)
~~~

%Dラインの計算式：[1] ストキャスティクス：ファストストキャスティクスの%Dかつ、スローストキャスティクス %K求める

~~~ pine
stod = ta.sma(stok, 3)
~~~

%Dラインの計算式：[2] スローストキャスティクス%Dを求める

~~~ pine
slowstod = ta.sma(stod, 3)
~~~

### 一目均衡表

相場は買い方と売り方の均衡が崩れた時に大きく動く。  
どちらが優勢かが分かればよく、チャートでそれを一目で知ることができる。  
TradingViewではテンプレートで一目均衡表が用意されているので、これを表示させるのが手っ取り早い。  
かつ、期間の設定も不用意に変更する必要がないくらい固まっている。
