//@version=5

strategy("RangeBreak and TrailingStop Test",overlay=true)

//トレンド戦略(投資戦略)と反転戦略(ストップロス)を
//使った。戦略の練習です。

//MACD
fastlen = input.int(12)
slowlen = input.int(26)
signal = input.int(9)

[macd,sigl,hist] = ta.macd(close,12,26,9)

gc = ta.crossover(macd,sigl)
dc = ta.crossunder(macd,sigl)

plotshape(series = gc,color=color.yellow,location=location.belowbar,style=shape.labeldown,text="GC")
plotshape(series = dc,color=color.red,location=location.belowbar,style=shape.labeldown,text="DC")

length = input.int(20)
multi = input.int(1)

//rangebreak
rangeHigh = ta.highest(high,length)
rangeLow = ta.lowest(low,length)

plot(rangeHigh,color=color.red)

longCondition = close > rangeHigh - 10

if(longCondition)
    strategy.entry("long",strategy.long)
plotshape(series = longCondition,color=color.orange,location=location.abovebar,style=shape.labelup,text="LB")

//trailing stop
trailOffset = input.int(10)

var float trailStop = na

if(longCondition)
    trailStop := close - trailOffset

plotshape(series = close < trailStop,color=color.green,location=location.abovebar,style=shape.labelup,text="SL")

if(close < trailStop)
    strategy.close("long")

plot(trailStop,color=color.orange)